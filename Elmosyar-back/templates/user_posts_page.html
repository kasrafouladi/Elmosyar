{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="user-posts-page" style="max-width: 900px; margin: 0 auto; padding: 20px;">
    <!-- Back Button -->
    <a href="/profiles/{{ profile_user.username }}/" 
       style="display: inline-block; margin-bottom: 20px; color: #2196F3; text-decoration: none;">
        â† Back to Profile
    </a>

    <!-- Page Header -->
    <div class="page-header" style="text-align: center; margin-bottom: 30px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1>{{ profile_user.username }}'s Posts</h1>
        <p style="color: #666;">All posts by this user</p>
    </div>

    <!-- Posts Container -->
    <div id="posts-container"></div>
</div>

<script>
    const API_BASE = window.location.origin;
    const USERNAME = "{{ profile_user.username }}";

    function renderPost(post) {
        let mediaHtml = '';
        if (post.media && post.media.length) {
            post.media.forEach(media => {
                if (media.type === 'image') {
                    mediaHtml += `<img src="${media.url}" style="max-width: 100%; border-radius: 8px; margin: 10px 0;">`;
                } else if (media.type === 'video') {
                    mediaHtml += `<video src="${media.url}" controls style="max-width: 100%; border-radius: 8px; margin: 10px 0;"></video>`;
                }
            });
        }

        const tagsHtml = post.tags.length ? 
            `<div style="color: #2196F3; font-size: 12px; margin: 5px 0;">ğŸ“Œ ${post.tags.join(', ')}</div>` : '';

        const roomHtml = post.category ? 
            `<div style="margin: 5px 0;">
                <a href="/explore/?room=${encodeURIComponent(post.category)}" 
                   style="background: #4CAF50; color: white; padding: 4px 8px; border-radius: 12px; text-decoration: none; font-size: 12px;">
                   ğŸ  ${post.category}
                </a>
            </div>` : '';

        return `
            <div class="post" style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 15px 0; background: white;">
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                    <div style="flex: 1;">
                        <span style="color: #666; font-size: 12px;">
                            ${new Date(post.created_at).toLocaleString()}
                        </span>
                    </div>
                    <a href="/posts/${post.id}/" 
                       style="background: #2196F3; color: white; padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 12px;">
                       ğŸ” View Post
                    </a>
                </div>
                <div style="margin: 10px 0; line-height: 1.5;">${post.content}</div>
                ${mediaHtml}
                ${tagsHtml}
                ${roomHtml}
                <div style="display: flex; gap: 15px; margin-top: 10px; font-size: 12px; color: #666;">
                    <span>ğŸ‘ ${post.likes_count} Likes</span>
                    <span>ğŸ’¬ ${post.comments_count} Comments</span>
                    <span>ğŸ”„ ${post.reposts_count} Reposts</span>
                </div>
            </div>
        `;
    }

    async function loadUserPosts() {
        try {
            const response = await fetch(`${API_BASE}/api/users/${USERNAME}/posts/`);
            const data = await response.json();
            
            const container = document.getElementById('posts-container');
            
            if (data.success && data.posts.length > 0) {
                container.innerHTML = data.posts.map(renderPost).join('');
            } else {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No posts yet.</p>';
            }
        } catch (error) {
            console.error('Error loading posts:', error);
            document.getElementById('posts-container').innerHTML = 
                '<p style="text-align: center; color: red;">Error loading posts</p>';
        }
    }

    document.addEventListener('DOMContentLoaded', loadUserPosts);
</script>
{% endblock %}